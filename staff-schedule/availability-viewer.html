<!DOCTYPE html>
<html lang="en">
<!-- Written by Brandon Stafford but really Claude (Sonnet 4.5), 2025-01-11 -->
<!-- (Claude the AI, not Claude Debussy or Claude Monet)                    -->
<!-- License: Creative Commons BY-SA                                        -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Availability Scheduler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .input-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        label {
            margin-bottom: 0;
            font-weight: 600;
            color: #555;
            white-space: nowrap;
        }
        
        input[type="file"] {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .grid-container {
            overflow: auto;
            margin-top: 20px;
            max-height: 70vh;
        }
        
        table {
            border-collapse: collapse;
            background: white;
            font-size: 11px;
        }
        
        th, td {
            padding: 4px 8px;
            text-align: center;
            border: 1px solid #ddd;
            min-width: 40px;
        }
        
        th {
            background: #3b82f6;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            height: 120px;
            white-space: nowrap;
            cursor: pointer;
            transition: background 0.3s;
            padding: 8px 4px;
        }
        
        th:not(:first-child):hover {
            background: #2563eb;
        }
        
        th.disabled {
            background: #cbd5e0;
        }
        
        td.disabled {
            background: #f3f4f6;
        }
        
        td.disabled .cell {
            opacity: 0.3;
        }
        
        td:first-child {
            position: sticky;
            left: 0;
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
            z-index: 5;
            min-width: 140px;
            font-size: 10px;
        }
        
        tr.alt-hour td:first-child {
            background: #dfe3e8;
        }
        
        tr.alt-hour {
            background: #eff1f3;
        }
        
        tr.day-divider td {
            border-top: 3px solid #3b82f6;
        }
        
        th:first-child {
            position: sticky;
            left: 0;
            background: #1e40af;
            z-index: 15;
            writing-mode: horizontal-tb;
            height: auto;
        }
        
        .cell {
            width: 100%;
            height: 30px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #666;
            font-weight: 600;
        }
        
        .cell.available {
            background: #48bb78;
            color: white;
        }
        
        .cell.partial {
            background: #f6ad55;
            color: white;
        }
        
        .cell.low {
            background: #fc8181;
            color: white;
        }
        
        .workers-list {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .worker-item {
            display: inline-block;
            background: white;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 6px;
            border: 2px solid #667eea;
            font-size: 14px;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #ddd;
        }

        .error {
            color: #e53e3e;
            background: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #fc8181;
        }

        .info {
            color: #2d3748;
            background: #e6fffa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #81e6d9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Nolop Shift Availability</h1>
        
        <div class="input-section">
            <div class="input-group">
                <label for="csvFile">Select CSV File:</label>
                <input type="file" id="csvFile" accept=".csv">
                <button onclick="loadCSV()">Load Availability Data</button>
            </div>
        </div>
        
        <div id="errorMessage"></div>
        
        <div class="grid-container" id="gridContainer" style="display: none;">
            <table id="scheduleTable">
                <thead>
                    <tr id="headerRow">
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        let scheduleData = [];
        let workers = [];
        let disabledWorkers = new Set();

        function loadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showError('Please select a CSV file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    parseCSV(e.target.result);
                    renderSchedule();
                    document.getElementById('gridContainer').style.display = 'block';
                    document.getElementById('errorMessage').innerHTML = '';
                } catch (error) {
                    showError('Error parsing CSV: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            scheduleData = [];
            const tempData = [];
            
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // First column is Time, rest are worker names
            const originalWorkers = headers.slice(1);
            
            // Parse each data row
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const cols = line.split(',').map(c => c.trim());
                const timeStr = cols[0];
                const availability = cols.slice(1).map(v => parseInt(v) === 1);
                
                tempData.push({
                    time: timeStr,
                    availability: availability
                });
            }
            
            // Sort workers by first availability
            const workerFirstAvailability = originalWorkers.map((worker, idx) => {
                const firstAvailable = tempData.findIndex(row => row.availability[idx]);
                return {
                    worker: worker,
                    originalIndex: idx,
                    firstAvailable: firstAvailable === -1 ? 999999 : firstAvailable
                };
            });
            
            workerFirstAvailability.sort((a, b) => a.firstAvailable - b.firstAvailable);
            
            // Set reordered workers
            workers = workerFirstAvailability.map(w => w.worker);
            const indexMap = workerFirstAvailability.map(w => w.originalIndex);
            
            // Reorder availability data
            tempData.forEach(row => {
                const newAvailability = indexMap.map(oldIdx => row.availability[oldIdx]);
                scheduleData.push({
                    time: row.time,
                    availability: newAvailability
                });
            });
        }
        
        function formatWorkerNames(workerList) {
            // Check for duplicate first names
            const firstNames = workerList.map(name => name.split(' ')[0]);
            const firstNameCounts = {};
            firstNames.forEach(fn => {
                firstNameCounts[fn] = (firstNameCounts[fn] || 0) + 1;
            });
            
            return workerList.map(name => {
                const parts = name.split(' ');
                if (parts.length === 1) {
                    return name; // No surname to process
                }
                
                const firstName = parts[0];
                const surname = parts.slice(1).join(' ');
                
                // If first name is unique, just use first name
                if (firstNameCounts[firstName] === 1) {
                    return firstName;
                }
                
                // Otherwise, abbreviate surname to first letter
                return `${firstName} ${surname[0]}`;
            });
        }

        function renderSchedule() {
            // Create headers
            const headerRow = document.getElementById('headerRow');
            headerRow.innerHTML = '<th>Time</th>';
            
            // Separate enabled and disabled workers
            const enabledWorkers = workers.filter(w => !disabledWorkers.has(w));
            const disabledWorkersList = workers.filter(w => disabledWorkers.has(w));
            const orderedWorkers = [...enabledWorkers, ...disabledWorkersList];
            
            // Format worker names
            const formattedNames = formatWorkerNames(orderedWorkers);
            
            orderedWorkers.forEach((worker, idx) => {
                const th = document.createElement('th');
                th.textContent = formattedNames[idx];
                th.dataset.worker = worker;
                th.onclick = () => toggleWorker(worker);
                if (disabledWorkers.has(worker)) {
                    th.classList.add('disabled');
                }
                headerRow.appendChild(th);
            });

            // Group data by day
            const dayGroups = {};
            days.forEach(day => dayGroups[day] = []);
            
            scheduleData.forEach(row => {
                const day = days.find(d => row.time.startsWith(d));
                if (day) {
                    dayGroups[day].push(row);
                }
            });

            // Create rows
            const tbody = document.getElementById('scheduleBody');
            tbody.innerHTML = '';
            
            days.forEach((day, dayIndex) => {
                const dayData = dayGroups[day];
                if (dayData.length === 0) return;
                
                dayData.forEach((timeSlot, index) => {
                    const tr = document.createElement('tr');
                    
                    // Add day divider class to first row of each day (except first day)
                    if (index === 0 && dayIndex > 0) {
                        tr.classList.add('day-divider');
                    }
                    
                    // Extract hour from time string to determine alternating pattern
                    const timeMatch = timeSlot.time.match(/(\d{1,2}):/);
                    if (timeMatch) {
                        const hour = parseInt(timeMatch[1]);
                        if (hour % 2 === 0) {
                            tr.classList.add('alt-hour');
                        }
                    }
                    
                    const timeCell = document.createElement('td');
                    timeCell.textContent = timeSlot.time;
                    tr.appendChild(timeCell);

                    orderedWorkers.forEach(worker => {
                        const workerIdx = workers.indexOf(worker);
                        const isAvailable = timeSlot.availability[workerIdx];
                        
                        const td = document.createElement('td');
                        if (disabledWorkers.has(worker)) {
                            td.classList.add('disabled');
                        }
                        
                        const div = document.createElement('div');
                        div.className = 'cell';
                        
                        if (isAvailable) {
                            div.classList.add('available');
                            div.textContent = 'âœ“';
                        } else {
                            div.textContent = '';
                        }
                        
                        td.appendChild(div);
                        tr.appendChild(td);
                    });

                    tbody.appendChild(tr);
                });
            });
        }
        
        function toggleWorker(worker) {
            if (disabledWorkers.has(worker)) {
                disabledWorkers.delete(worker);
            } else {
                disabledWorkers.add(worker);
            }
            renderSchedule();
        }

        function updateWorkersList() {
            const workersList = document.getElementById('workersCount');
            if (workers.length === 0) {
                workersList.textContent = 'None';
            } else {
                workersList.innerHTML = '';
                workers.forEach(worker => {
                    const span = document.createElement('span');
                    span.className = 'worker-item';
                    span.textContent = worker;
                    workersList.appendChild(span);
                });
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
        }
    </script>
</body>
</html>
